<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Security Form View -->
    <record id="view_stock_security_form" model="ir.ui.view">
        <field name="name">stock.security.form</field>
        <field name="model">stock.security</field>
        <field name="arch" type="xml">
            <form string="Security">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_order_book" type="object" class="oe_stat_button" icon="fa-book">
                            <div class="o_stat_info">
                                <field name="bid_count" class="o_stat_value"/>
                                <span class="o_stat_text">Bids</span>
                            </div>
                            <div class="o_stat_info">
                                <field name="ask_count" class="o_stat_value"/>
                                <span class="o_stat_text">Asks</span>
                            </div>
                        </button>
                        <button name="action_view_trades" type="object" class="oe_stat_button" icon="fa-exchange">
                            <field name="volume_today" widget="statinfo" string="Volume"/>
                        </button>
                        <button name="%(action_stock_order)d" type="action" class="oe_stat_button" icon="fa-plus-circle"
                                context="{'default_security_id': id}">
                            <span>Place Order</span>
                        </button>
                    </div>
                    <widget name="web_ribbon" title="Inactive" bg_color="bg-danger" invisible="active"/>
                    <div class="oe_title">
                        <label for="symbol" class="oe_edit_only"/>
                        <h1>
                            <field name="symbol" placeholder="e.g. AAPL"/>
                        </h1>
                        <label for="name" class="oe_edit_only"/>
                        <h3>
                            <field name="name" placeholder="Security Name"/>
                        </h3>
                    </div>
                    <group>
                        <group string="General Information">
                            <field name="security_type"/>
                            <field name="sector"/>
                            <field name="active"/>
                            <field name="status"/>
                            <field name="ipo_price"/>
                            <field name="current_offering_quantity" invisible="status == 'trade'"/>
                            <field name="offering_round" invisible="status == 'trade'"/>
                        </group>
                        <group string="Current Pricing">
                            <field name="current_price"/>
                            <field name="change_amount" 
                                   decoration-success="change_amount > 0" 
                                   decoration-danger="change_amount &lt; 0"/>
                            <field name="change_percentage" widget="percentage" options="{'factor': 1.0}"
                                   decoration-success="change_percentage > 0" 
                                   decoration-danger="change_percentage &lt; 0"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Trading Information" name="trading">
                            <group>
                                <group string="Market Data">
                                    <field name="session_start_price"/>
                                    <field name="price_to_compare_with"/>
                                    <field name="previous_close"/>
                                    <field name="vwap"/>
                                    <field name="value_today"/>
                                </group>
                                <group string="Order Book">
                                    <field name="best_bid"/>
                                    <field name="best_ask"/>
                                    <label for="best_bid" string="Spread"/>
                                    <div>
                                        <span class="text-muted">Calculated at runtime</span>
                                    </div>
                                </group>
                            </group>
                        </page>
                        <page string="IPO/PO History" name="offering_history" invisible="offering_round == 1">>
                            <group>
                                <field name="offering_history" widget="text" readonly="1"/>
                            </group>
                        </page>
                        <page string="Trading Rules" name="rules">
                            <group>
                                <group string="Price Rules">
                                    <field name="tick_size"/>
                                </group>
                                <group string="Quantity Rules">
                                    <field name="lot_size"/>
                                    <field name="max_order_size"/>
                                </group>
                            </group>
                        </page>
                        <page string="Price History" name="history">
                            <field name="price_history_ids" readonly="1">
                                <list>
                                    <field name="change_date"/>
                                    <field name="old_price"/>
                                    <field name="new_price"/>
                                    <field name="change_percentage" widget="percentage"/>
                                    <field name="change_reason"/>
                                </list>
                            </field>
                        </page>
                        <page string="Positions" name="positions">
                            <field name="position_ids" readonly="1">
                                <list>
                                    <field name="user_id"/>
                                    <field name="quantity"/>
                                    <field name="average_cost"/>
                                    <field name="market_value"/>
                                    <field name="unrealized_pnl" 
                                           decoration-success="unrealized_pnl > 0" 
                                           decoration-danger="unrealized_pnl &lt; 0"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>
    
    <!-- Security Tree View -->
    <record id="view_stock_security_tree" model="ir.ui.view">
        <field name="name">stock.security.tree</field>
        <field name="model">stock.security</field>
        <field name="arch" type="xml">
            <list string="Securities">
                <field name="symbol"/>
                <field name="name"/>
                <field name="security_type"/>
                <field name="sector"/>
                <field name="status"/>
                <field name="current_price"/>
                <field name="change_amount" 
                       decoration-success="change_amount > 0" 
                       decoration-danger="change_amount &lt; 0"/>
                <field name="change_percentage" widget="percentage" options="{'factor': 1.0}"
                       decoration-success="change_percentage > 0" 
                       decoration-danger="change_percentage &lt; 0"/>
                <field name="volume_today"/>
                <field name="vwap"/>
                <field name="active" invisible="1"/>
            </list>
        </field>
    </record>
    
    <!-- Security Kanban View -->
    <record id="view_stock_security_kanban" model="ir.ui.view">
        <field name="name">stock.security.kanban</field>
        <field name="model">stock.security</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="symbol"/>
                <field name="name"/>
                <field name="current_price"/>
                <field name="change_percentage"/>
                <field name="volume_today"/>
                <field name="security_type"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="symbol"/> - <field name="name"/>
                                </strong>
                                <div class="text-muted">
                                    <field name="security_type"/>
                                </div>
                                <div class="mt-2">
                                    <strong>Price: </strong>
                                    <field name="current_price"/>
                                    <span t-attf-class="ml-2 #{record.change_percentage.raw_value > 0 ? 'text-success' : 'text-danger'}">
                                        <field name="change_percentage" widget="percentage" options="{'factor': 1.0}"/>
                                    </span>
                                </div>
                                <div>
                                    <strong>Volume: </strong>
                                    <field name="volume_today"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Security Search View -->
    <record id="view_stock_security_search" model="ir.ui.view">
        <field name="name">stock.security.search</field>
        <field name="model">stock.security</field>
        <field name="arch" type="xml">
            <search string="Securities">
                <field name="symbol"/>
                <field name="name"/>
                <field name="sector"/>
                <field name="status"/>
                <filter string="Active" name="filter_active" domain="[('active', '=', True)]"/>
                <filter string="Inactive" name="filter_inactive" domain="[('active', '=', False)]"/>
                <separator/>
                <filter string="Stocks" name="filter_stock" domain="[('security_type', '=', 'stock')]"/>
                <filter string="Bonds" name="filter_bond" domain="[('security_type', '=', 'bond')]"/>
                <filter string="Mutual Funds" name="filter_mf" domain="[('security_type', '=', 'mf')]"/>
                <separator/>
                <filter string="IPO Securities" name="filter_ipo" domain="[('status', '=', 'ipo')]"/>
                <filter string="PO Securities" name="filter_po" domain="[('status', '=', 'po')]"/>
                <filter string="Trading Securities" name="filter_trading" domain="[('status', '=', 'trade')]"/>
                <separator/>
                <filter string="Information Technology" name="filter_tech" domain="[('sector', '=', 'information_technology')]"/>
                <filter string="Financials" name="filter_financials" domain="[('sector', '=', 'financials')]"/>
                <filter string="Health Care" name="filter_healthcare" domain="[('sector', '=', 'health_care')]"/>
                <filter string="Industrials" name="filter_industrials" domain="[('sector', '=', 'industrials')]"/>
                <group expand="0" string="Group By">
                    <filter string="Type" name="group_by_type" context="{'group_by': 'security_type'}"/>
                    <filter string="Status" name="group_by_status" context="{'group_by': 'status'}"/>
                    <filter string="Sector" name="group_by_sector" context="{'group_by': 'sector'}"/>
                    <filter string="Active" name="group_by_active" context="{'group_by': 'active'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Security Action -->
    <record id="action_stock_security" model="ir.actions.act_window">
        <field name="name">Securities</field>
        <field name="res_model">stock.security</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_filter_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Add a new security
            </p>
            <p>
                Securities are the tradeable instruments in your market including stocks, bonds, and mutual funds.
            </p>
        </field>
    </record>
    
</odoo> 